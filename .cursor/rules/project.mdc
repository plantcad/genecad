---
description:
globs:
alwaysApply: true
---
## Files
- Use `local` as a directory outside of source control for scratch work like planning documents and ad-hoc scripts

## Scripts
- Always run `source ~/.projectrc` in a terminal once before running anything else; this will change directories to this repository and initialize certain env vars as well as add this repository to the PYTHONPATH
- Never change to this project repository directory yourself, always use `source ~/.projectrc`
- Put any ad-hoc, utility scripts in `local/scratch`, which is not saved to source control; that should be your default choice unless prompted to do otherwise
- Ensure that outputs of any of those scripts (plots, csvs, etc.) are also saved in `local/scratch` by default
- If necessary, save the output of script runs to an appropriately named log file in `local/logs/exec`
- Do not add `sys.path.append(...)` to scripts EVER; source code is added to the PYTHONPATH by `.projectrc`

## Execution
- Assume this project is undergoing development on a local CPU-only workstation unless instructed otherwise
  - All cpu-intensive or gpu-enabled operations must be offloaded to the TACC HPC cluster
  - For TACC instructions (environment, job allocation, syncing, execution, paths), see `.claude/skills/tacc/SKILL.md`
- Pre-commit: if `pyrefly` is not installed locally, install it with `uv pip install pyrefly`

## Coding
- Use NumPy style docstrings
- Use `numpy.typing` for numpy array annotations
- Use type annotations very liberally
  - Use type hints according to the standard *after* to Python 3.9, i.e. `list`, `dict`, `int | None`, etc. rather than `List`, `Dict`, `Optional[int]`
- Use early returns to avoid deeply nested if statements
- Always prefer loggers over print statements unless instructed otherwise

## Testing
- Use `pytest` for unit tests
- Prefer `pytest.mark.parametrize` over boilerplate in test cases
- Always start with small, simple tests and expand upon request
- Use absolute imports for project modules, e.g. `from src.module import ...`

## Naming
- Do not suffix variable names with `_df` or `_ds` when referencing Pandas, Xarray or other rich data structures; e.g. use "attributes" instead of "attr_df"
